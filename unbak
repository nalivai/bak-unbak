#!/bin/bash
if [[ ! $1 ]]; then
	echo restoring previously backed up copy of the file 
	echo     usage: unbak FILENAME [-r]
	echo            -r: deletes the copy
	exit 1
fi

backupname=$1
suffix="/"
backupname=${backupname%"$suffix"}
restoredname=$backupname
backupname=$backupname.bak

shift;
OPTS=`getopt -o rd --long delete -n 'parse-options' -- "$@"`
while true; do
case "$1" in
	-d | --delete | -r		) delete=1; shift ;;
	-- ) shift; break ;;
	* ) break ;;
esac
done

if [[ -f $backupname ]] || [[ -d $backupname ]]; then
	echo "restoring file $backupname"
	if [[ -d $backupname ]]; then
		backupname="$backupname/"
	fi
	rm $restoredname -rf
	cp -raT $backupname $restoredname
	# cp -raT $backupname/. $restoredname
	if [[ $delete == 1 ]]; then
		echo "and removing backup"
		rm -rf $backupname
	fi
else
	echo "backuped file $backupname not found"
fi

